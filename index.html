<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Speed Quiz Premium</title>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --primary: #4f46e5;
            --primary-light: #818cf8;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --bg: #f1f5f9;
            --card: #ffffff;
            --text-main: #1e293b;
            --text-sub: #64748b;
            --radius: 16px;
            --shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        * {
            box-sizing: border-box;
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background-color: var(--bg);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ (ì•± í”„ë ˆì„) */
        .app-container {
            width: 100%;
            max-width: 480px;
            height: 90vh;
            background: var(--card);
            border-radius: 30px;
            box-shadow: var(--shadow);
            position: relative;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            margin: 10px;
        }

        /* ê³µí†µ í—¤ë” */
        .header {
            padding: 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .header h1 { font-size: 1.25rem; margin: 0; font-weight: 700; color: var(--text-main); }

        /* ë·° ì „í™˜ ì• ë‹ˆë©”ì´ì…˜ */
        .view {
            padding: 0 24px 24px 24px;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow-y: auto;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .hidden { display: none !important; }

        /* ë²„íŠ¼ ë””ìì¸ */
        .btn {
            border: none;
            border-radius: var(--radius);
            padding: 16px 24px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active { transform: scale(0.96); opacity: 0.9; }

        .btn-primary { background: var(--primary); color: white; }
        .btn-secondary { background: #f1f5f9; color: var(--text-main); }
        .btn-outline { background: transparent; border: 2px solid #e2e8f0; color: var(--text-sub); }
        .btn-ghost { background: #f8fafc; border: 1px solid #f1f5f9; color: var(--text-main); padding: 12px; }

        /* í€´ì¦ˆ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œ */
        .quiz-card {
            background: #f8fafc;
            border-radius: var(--radius);
            padding: 20px;
            margin-bottom: 16px;
            border: 1px solid #f1f5f9;
        }

        .quiz-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 12px; }
        .quiz-card-title { font-size: 1.1rem; font-weight: 700; }
        .quiz-card-meta { font-size: 0.85rem; color: var(--text-sub); }

        /* ì…ë ¥ í¼ ìŠ¤íƒ€ì¼ */
        .input-group { margin-bottom: 20px; }
        .input-group label { display: block; font-size: 0.9rem; font-weight: 600; color: var(--text-sub); margin-bottom: 8px; }
        input[type="text"], input[type="number"], textarea {
            width: 100%;
            padding: 14px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            outline: none;
            transition: border-color 0.2s;
        }
        input:focus { border-color: var(--primary); }

        /* ì¸ê²Œì„ UI */
        .play-header { text-align: center; margin-bottom: 40px; }
        .timer-circle {
            width: 80px; height: 80px; border-radius: 50%; border: 4px solid var(--primary);
            display: flex; align-items: center; justify-content: center;
            margin: 0 auto 10px; font-size: 1.5rem; font-weight: 800; color: var(--primary);
        }
        .score-box { font-size: 0.9rem; font-weight: 600; color: var(--text-sub); }
        .word-display {
            background: #f8fafc;
            border-radius: 24px;
            height: 200px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 40px;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.05);
            text-align: center;
            padding: 20px;
        }

        /* ì‹œìƒëŒ€ ë””ìì¸ */
        .podium { display: flex; align-items: flex-end; justify-content: center; gap: 10px; margin: 40px 0; height: 200px; }
        .podium-item { flex: 1; display: flex; flex-direction: column; align-items: center; border-radius: 12px 12px 0 0; position: relative; padding-bottom: 10px; color: white; }
        .rank-2 { height: 60%; background: #94a3b8; order: 1; }
        .rank-1 { height: 90%; background: var(--warning); order: 2; box-shadow: 0 0 20px rgba(245, 158, 11, 0.3); }
        .rank-3 { height: 40%; background: #b45309; order: 3; }
        .podium-label { position: absolute; top: -30px; color: var(--text-main); font-weight: 800; }

        /* ê·¸ë£¹ ë²„íŠ¼ */
        .group-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .group-btn {
            aspect-ratio: 1;
            background: white;
            border: 2px solid #f1f5f9;
            border-radius: 20px;
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--primary);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05);
        }
        .group-btn:disabled { opacity: 0.3; filter: grayscale(1); }

    </style>
</head>
<body>

<div class="app-container">
    <div id="main-view" class="view">
        <div style="flex-grow: 1; display: flex; flex-direction: column; justify-content: center; align-items: center;">
            <div style="font-size: 80px; margin-bottom: 20px;">ğŸš€</div>
            <h1 style="font-size: 2.5rem; margin-bottom: 8px;">Speed Quiz</h1>
            <p style="color: var(--text-sub); margin-bottom: 40px;">ìŠ¤ë§ˆíŠ¸í•˜ê³  ë¹ ë¥¸ í€´ì¦ˆ íˆ´</p>
            <button class="btn btn-primary" style="width: 100%;" onclick="showView('list-view')">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <div id="list-view" class="view hidden">
        <div class="header">
            <h1>ë‚˜ì˜ í€´ì¦ˆ</h1>
            <button class="btn btn-outline" style="padding: 8px 16px;" onclick="showView('main-view')">í™ˆ</button>
        </div>
        <div id="quiz-list-items" style="flex-grow: 1;"></div>
        <button class="btn btn-primary" onclick="openAdmin()">+ ìƒˆ í€´ì¦ˆ ë§Œë“¤ê¸°</button>
    </div>

    <div id="admin-view" class="view hidden">
        <div class="header">
            <h1 id="admin-title">í€´ì¦ˆ ì„¤ì •</h1>
        </div>
        <div style="flex-grow: 1; overflow-y: auto;">
            <div class="input-group">
                <label>í€´ì¦ˆ ì œëª©</label>
                <input type="text" id="quiz-title-input" placeholder="ì˜ˆ: ìƒì‹ í€´ì¦ˆ ëŒ€íšŒ">
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>ê·¸ë£¹ ìˆ˜ (max 10)</label>
                    <input type="number" id="group-count" value="3" onchange="renderGroupInputs()">
                </div>
                <div class="input-group">
                    <label>ë‹¨ì–´ ìˆ˜ (max 40)</label>
                    <input type="number" id="word-count" value="5">
                </div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="input-group">
                    <label>ì‹œê°„ (ì´ˆ)</label>
                    <input type="number" id="limit-time" value="60">
                </div>
                <div class="input-group">
                    <label>íŒ¨ìŠ¤ ì œí•œ</label>
                    <input type="number" id="pass-limit" value="3">
                </div>
            </div>
            <div id="groups-container"></div>
        </div>
        <div style="padding-top: 20px; display: flex; gap: 10px;">
            <button class="btn btn-outline" style="flex: 1;" onclick="showView('list-view')">ì·¨ì†Œ</button>
            <button class="btn btn-primary" style="flex: 2;" onclick="saveQuiz()">ì €ì¥í•˜ê¸°</button>
        </div>
    </div>

    <div id="selection-view" class="view hidden">
        <div class="header"><h1>ê·¸ë£¹ì„ ì„ íƒí•˜ì„¸ìš”</h1></div>
        <div id="sentence-display" style="font-size: 1.5rem; text-align: center; margin-bottom: 30px; font-weight: 800; color: var(--primary); letter-spacing: 4px;"></div>
        <div class="group-grid" id="group-buttons-container"></div>
        <div style="margin-top: auto; padding-top: 20px;">
            <button class="btn btn-outline" style="width: 100%;" onclick="showView('list-view')">ê²Œì„ ì¢…ë£Œ</button>
        </div>
    </div>

    <div id="play-view" class="view hidden">
        <div class="play-header">
            <div class="timer-circle" id="timer-display">60</div>
            <div class="score-box">ì •ë‹µ ê°œìˆ˜: <span id="current-score" style="color: var(--primary);">0</span></div>
        </div>
        <div class="word-display" id="word-display">READY</div>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
            <button class="btn btn-primary" style="background: var(--success); height: 80px;" onclick="handleAnswer(true)">ì •ë‹µ</button>
            <button class="btn btn-primary" style="background: var(--danger); height: 80px;" onclick="handleAnswer(false)">ì˜¤ë‹µ</button>
            <button id="pass-btn" class="btn btn-secondary" style="grid-column: span 2;" onclick="handlePass()">íŒ¨ìŠ¤ (<span id="pass-count">0</span>)</button>
        </div>
    </div>

    <div id="result-view" class="view hidden">
        <div class="header"><h1>ìµœì¢… ê²°ê³¼</h1></div>
        <div class="podium" id="podium-area"></div>
        <div id="rank-list-simple" style="margin-bottom: 20px;"></div>
        <div id="bonus-area" class="hidden">
            <button class="btn btn-primary" style="width: 100%; background: var(--warning); margin-bottom: 10px;" onclick="startBonusGame()">ğŸ”¥ ë™ì ì ë³´ë„ˆìŠ¤ ëŒ€ê²°</button>
        </div>
        <button class="btn btn-outline" style="width: 100%;" onclick="showView('main-view')">í™ˆìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
    </div>
</div>

<script>
    /* ë¡œì§ì€ ìœ„ì™€ ë™ì¼í•˜ê²Œ ìœ ì§€í•˜ë˜ UI ì—°ê²°ë§Œ ì—…ë°ì´íŠ¸ */
    let quizzes = JSON.parse(localStorage.getItem('quizzes_v2')) || [];
    let currentQuiz = null;
    let editingIndex = -1;
    let playingGroupIdx = -1;
    let results = [];
    let playedGroups = new Set();
    let gameTimer = null;
    let timeLeft = 0;
    let currentWords = [];
    let currentWordIdx = 0;
    let currentCorrect = 0;
    let currentPasses = 0;

    function showView(viewId) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.getElementById(viewId).classList.remove('hidden');
        if(viewId === 'list-view') renderQuizList();
    }

    function renderQuizList() {
        const container = document.getElementById('quiz-list-items');
        container.innerHTML = quizzes.length ? '' : '<p style="text-align:center; color:#94a3b8; margin-top:40px;">ë“±ë¡ëœ í€´ì¦ˆê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        quizzes.forEach((q, i) => {
            const card = document.createElement('div');
            card.className = 'quiz-card';
            card.innerHTML = `
                <div class="quiz-card-header">
                    <div>
                        <div class="quiz-card-title">${q.title}</div>
                        <div class="quiz-card-meta">${q.groups.length}ê°œ ê·¸ë£¹ â€¢ ê·¸ë£¹ë‹¹ ${q.wordCount}ë‹¨ì–´</div>
                    </div>
                    <button class="btn-ghost" onclick="deleteQuiz(${i})">ğŸ—‘ï¸</button>
                </div>
                <div style="display:flex; gap:8px;">
                    <button class="btn btn-primary" style="flex:1; padding:10px;" onclick="startQuiz(${i})">ì‹œì‘</button>
                    <button class="btn btn-secondary" style="flex:1; padding:10px;" onclick="openAdmin(${i})">ìˆ˜ì •</button>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function renderGroupInputs() {
        const container = document.getElementById('groups-container');
        const count = Math.min(parseInt(document.getElementById('group-count').value) || 0, 10);
        container.innerHTML = '<h3 style="margin:20px 0 10px; font-size:1rem;">ê·¸ë£¹ë³„ ì„¸ë¶€ ì„¤ì •</h3>';
        for(let i=0; i<count; i++) {
            const div = document.createElement('div');
            div.style.padding = "15px";
            div.style.background = "#f8fafc";
            div.style.borderRadius = "12px";
            div.style.marginBottom = "10px";
            div.innerHTML = `
                <input type="text" class="g-name" placeholder="${i+1}ë²ˆ ê·¸ë£¹ ì´ë¦„ (ì˜ˆ: í•œê¸€ì)" style="margin-bottom:8px">
                <textarea class="g-words" rows="2" placeholder="ë‹¨ì–´ë“¤ì„ ì½¤ë§ˆ(,)ë¡œ êµ¬ë¶„í•´ ì…ë ¥"></textarea>
            `;
            container.appendChild(div);
        }
    }

    function openAdmin(idx = -1) {
        editingIndex = idx;
        renderGroupInputs();
        if(idx > -1) {
            const q = quizzes[idx];
            document.getElementById('quiz-title-input').value = q.title;
            document.getElementById('group-count').value = q.groups.length;
            document.getElementById('word-count').value = q.wordCount;
            document.getElementById('limit-time').value = q.time;
            document.getElementById('pass-limit').value = q.pass;
            renderGroupInputs();
            const names = document.querySelectorAll('.g-name');
            const words = document.querySelectorAll('.g-words');
            q.groups.forEach((g, i) => {
                if(names[i]) names[i].value = g.name;
                if(words[i]) words[i].value = g.words.join(',');
            });
        }
        showView('admin-view');
    }

    function saveQuiz() {
        const title = document.getElementById('quiz-title-input').value;
        const names = document.querySelectorAll('.g-name');
        const words = document.querySelectorAll('.g-words');
        if(!title) return alert('ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');

        let groups = [];
        for(let i=0; i<names.length; i++) {
            if(names[i].value) {
                groups.push({
                    name: names[i].value,
                    words: words[i].value.split(',').map(s => s.trim()).filter(s => s)
                });
            }
        }
        
        const newQuiz = {
            title,
            time: parseInt(document.getElementById('limit-time').value),
            pass: parseInt(document.getElementById('pass-limit').value),
            wordCount: parseInt(document.getElementById('word-count').value),
            groups
        };

        if(editingIndex > -1) quizzes[editingIndex] = newQuiz;
        else quizzes.push(newQuiz);

        localStorage.setItem('quizzes_v2', JSON.stringify(quizzes));
        showView('list-view');
    }

    function startQuiz(idx) {
        currentQuiz = quizzes[idx];
        results = [];
        playedGroups.clear();
        showSelection();
    }

    function showSelection() {
        showView('selection-view');
        document.getElementById('sentence-display').innerText = currentQuiz.groups.map(g => g.name).join(' ');
        const container = document.getElementById('group-buttons-container');
        container.innerHTML = '';
        currentQuiz.groups.forEach((g, i) => {
            const btn = document.createElement('button');
            btn.className = 'group-btn';
            btn.innerText = g.name;
            btn.disabled = playedGroups.has(i);
            btn.onclick = () => prepareGame(i);
            container.appendChild(btn);
        });
        if(playedGroups.size === currentQuiz.groups.length) showResults();
    }

    function prepareGame(groupIdx) {
        playingGroupIdx = groupIdx;
        showView('play-view');
        currentWords = [...currentQuiz.groups[groupIdx].words].sort(() => Math.random() - 0.5);
        currentWordIdx = 0; currentCorrect = 0;
        currentPasses = currentQuiz.pass;
        timeLeft = currentQuiz.time;
        updatePlayUI();
        
        let cnt = 3;
        const cd = document.getElementById('word-display');
        const interval = setInterval(() => {
            cd.innerText = cnt;
            if(cnt === 0) {
                clearInterval(interval);
                runGame();
            }
            cnt--;
        }, 800);
    }

    function runGame() {
        nextWord();
        gameTimer = setInterval(() => {
            timeLeft--;
            document.getElementById('timer-display').innerText = timeLeft;
            if(timeLeft <= 0) endGame();
        }, 1000);
    }

    function nextWord() {
        if(currentWordIdx >= currentWords.length) return endGame();
        document.getElementById('word-display').innerText = currentWords[currentWordIdx];
    }

    function updatePlayUI() {
        document.getElementById('current-score').innerText = currentCorrect;
        document.getElementById('pass-count').innerText = currentPasses;
        document.getElementById('timer-display').innerText = timeLeft;
    }

    function handleAnswer(isCorrect) {
        if(isCorrect) currentCorrect++;
        currentWordIdx++;
        updatePlayUI();
        nextWord();
    }

    function handlePass() {
        if(currentPasses > 0) {
            currentPasses--;
            currentWordIdx++;
            updatePlayUI();
            nextWord();
        }
    }

    function endGame() {
        clearInterval(gameTimer);
        results.push({ name: currentQuiz.groups[playingGroupIdx].name, score: currentCorrect });
        playedGroups.add(playingGroupIdx);
        showSelection();
    }

    function showResults() {
        showView('result-view');
        const sorted = [...results].sort((a,b) => b.score - a.score);
        const podium = document.getElementById('podium-area');
        podium.innerHTML = '';
        
        // ì‹œìƒëŒ€ ì—°ì¶œ
        const ranks = ['rank-2', 'rank-1', 'rank-3'];
        [1, 0, 2].forEach((idx, i) => {
            if(sorted[idx]) {
                const item = document.createElement('div');
                item.className = `podium-item ${ranks[i]}`;
                item.innerHTML = `<span class="podium-label">${idx+1}ìœ„</span><strong>${sorted[idx].name}</strong><span>${sorted[idx].score}ì </span>`;
                podium.appendChild(item);
            }
        });

        const bonusArea = document.getElementById('bonus-area');
        if(sorted.length > 1 && sorted[0].score === sorted[1].score) bonusArea.classList.remove('hidden');
        else bonusArea.classList.add('hidden');
    }

    function deleteQuiz(i) {
        if(confirm('ì´ í€´ì¦ˆë¥¼ ì‚­ì œí• ê¹Œìš”?')) {
            quizzes.splice(i, 1);
            localStorage.setItem('quizzes_v2', JSON.stringify(quizzes));
            renderQuizList();
        }
    }

    function startBonusGame() {
        const allWords = currentQuiz.groups.flatMap(g => g.words);
        currentQuiz = { ...currentQuiz, groups: [
            { name: "A", words: allWords.sort(() => Math.random() - 0.5).slice(0, 10) },
            { name: "B", words: allWords.sort(() => Math.random() - 0.5).slice(0, 10) }
        ]};
        results = []; playedGroups.clear(); showSelection();
    }

    renderQuizList();
</script>

</body>
</html>
