<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Speed Quiz Pro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <style>
        :root {
            --bg: #ffffff;
            --sidebar: #f8f9fa;
            --text: #1f1f1f;
            --text-sub: #5f6368;
            --border: #dadce0;
            --primary: #1a73e8;
            --primary-light: #e8f0fe;
            --success: #1e8e3e;
            --danger: #d93025;
            --warning: #f9ab00;
            --radius: 8px;
            --header-h: 64px;
        }

        [data-theme='dark'] {
            --bg: #131314;
            --sidebar: #1e1f20;
            --text: #e3e3e3;
            --text-sub: #c4c7c5;
            --border: #444746;
            --primary: #a8c7fa;
            --primary-light: #394457;
            --success: #6dd58c;
            --danger: #f28b82;
            --warning: #fdd663;
        }

        * { box-sizing: border-box; font-family: 'Pretendard', sans-serif; transition: background 0.3s, color 0.3s, border-color 0.3s; }
        
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: var(--bg); color: var(--text); overflow: hidden; }

        /* Layout */
        .layout { display: flex; flex-direction: column; height: 100vh; }
        
        header { 
            height: var(--header-h); border-bottom: 1px solid var(--border); 
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            background: var(--bg); z-index: 100;
        }

        .logo { font-size: 1.2rem; font-weight: 600; color: var(--primary); display: flex; align-items: center; gap: 10px; }

        .main-container { display: flex; flex: 1; overflow: hidden; }

        /* Sidebar */
        nav { width: 280px; background: var(--sidebar); border-right: 1px solid var(--border); padding: 20px; display: flex; flex-direction: column; gap: 8px; }

        /* Main View Container */
        main { flex: 1; overflow-y: auto; position: relative; padding: 40px; display: flex; flex-direction: column; }

        /* Elements */
        .btn {
            padding: 10px 24px; border-radius: 50px; border: 1px solid var(--border); 
            background: transparent; color: var(--text); font-weight: 500; cursor: pointer;
            display: inline-flex; align-items: center; justify-content: center; gap: 8px; font-size: 0.95rem;
        }
        .btn:hover { background: var(--primary-light); border-color: var(--primary); color: var(--primary); }
        .btn-filled { background: var(--primary); color: white !important; border: none; }
        .btn-filled:hover { filter: brightness(1.1); }

        .input {
            background: transparent; border: 1px solid var(--border); border-radius: var(--radius);
            padding: 12px 16px; color: var(--text); font-size: 1rem; width: 100%;
        }
        .input:focus { border-color: var(--primary); outline: none; box-shadow: 0 0 0 2px var(--primary-light); }

        /* Progress Bar */
        .timer-progress-wrap { position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: var(--border); }
        #timer-bar { width: 100%; height: 100%; background: var(--primary); transition: width 0.1s linear, background-color 0.3s; }

        /* Quiz ì§„í–‰ UI */
        .quiz-header { text-align: center; margin-bottom: 60px; }
        .word-display { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            font-size: 8rem; font-weight: 700; text-align: center;
        }
        
        .quiz-controls { display: flex; justify-content: center; gap: 40px; margin-bottom: 40px; }
        .control-btn {
            width: 120px; height: 120px; border-radius: 50%; border: 2px solid var(--border);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.3s;
        }
        .control-btn .symbol { font-size: 2.5rem; font-weight: 300; margin-bottom: 5px; }
        .control-btn .label { font-size: 0.85rem; font-weight: 600; }

        .btn-correct:hover { border-color: var(--success); color: var(--success); background: var(--primary-light); }
        .btn-wrong:hover { border-color: var(--danger); color: var(--danger); background: #fce8e6; }
        .btn-pass:hover { border-color: var(--warning); color: var(--warning); background: #fef7e0; }

        /* Editor UI */
        .editor-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 24px; margin-top: 30px; }
        .group-card { background: var(--sidebar); padding: 24px; border-radius: var(--radius); border: 1px solid var(--border); }

        /* Hidden Class */
        .hidden { display: none !important; }

        /* Animations */
        @keyframes flashSuccess { 0% { background: var(--bg); } 50% { background: #e6f4ea; } 100% { background: var(--bg); } }
        @keyframes flashWrong { 0% { background: var(--bg); } 50% { background: #fce8e6; } 100% { background: var(--bg); } }
        .animate-success { animation: flashSuccess 0.4s ease; }
        .animate-wrong { animation: flashWrong 0.4s ease; }

        /* Result Podium */
        .result-item { display: flex; align-items: center; padding: 20px; border-bottom: 1px solid var(--border); }
        .rank-num { font-size: 1.5rem; font-weight: 800; width: 60px; color: var(--primary); }
    </style>
</head>
<body data-theme="light">

<div class="layout">
    <header>
        <div class="logo">
            <span>Speed-Quiz</span>
        </div>
        <div style="display:flex; gap:16px; align-items:center;">
            <button class="btn" id="theme-toggle">ğŸŒ“ Theme</button>
            <button class="btn btn-filled" onclick="openAdmin()">+ Create Quiz</button>
        </div>
    </header>

    <div class="main-container">
        <nav id="sidebar">
            <p style="font-size: 0.8rem; font-weight: 700; color: var(--text-sub); margin-left: 12px; margin-bottom: 12px;">LIBRARY</p>
            <div id="quiz-list-sidebar"></div>
        </nav>

        <main>
            <div id="start-view" class="view">
                <h1 style="font-size: 3rem; margin-top: 100px;">ì•ˆë…•í•˜ì„¸ìš”,<br><span style="color:var(--primary)">ìŠ¤í”¼ë“œ í€´ì¦ˆ</span>ë¥¼ ì‹œì‘í• ê¹Œìš”?</h1>
                <p style="color:var(--text-sub); font-size: 1.1rem; max-width: 600px; line-height: 1.6;">
                    ë¼ì´ë¸ŒëŸ¬ë¦¬ì—ì„œ ê¸°ì¡´ í€´ì¦ˆë¥¼ ì„ íƒí•˜ê±°ë‚˜ ìš°ì¸¡ ìƒë‹¨ì˜ 'Create Quiz' ë²„íŠ¼ì„ ëˆŒëŸ¬ ìƒˆë¡œìš´ í”„ë¡œì íŠ¸ë¥¼ ë§Œë“œì„¸ìš”. 
                    Gemini ìŠ¤íƒ€ì¼ì˜ ì„¸ë ¨ëœ ì¸í„°í˜ì´ìŠ¤ë¡œ í€´ì¦ˆë¥¼ ì§„í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                </p>
            </div>

            <div id="admin-view" class="view hidden">
                <h2>í€´ì¦ˆ í¸ì§‘ê¸°</h2>
                <div style="max-width: 800px; display: grid; gap: 20px;">
                    <input type="text" id="quiz-title-input" class="input" placeholder="í”„ë¡œì íŠ¸ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                    <div style="display:flex; gap:16px;">
                        <input type="number" id="limit-time" class="input" value="60" placeholder="ì‹œê°„(ì´ˆ)">
                        <input type="number" id="group-count" class="input" value="3" onchange="renderGroupInputs()" placeholder="ê·¸ë£¹ ìˆ˜">
                    </div>
                </div>
                <div id="groups-container" class="editor-grid"></div>
                <div style="margin-top: 40px;">
                    <button class="btn btn-filled" onclick="saveQuiz()">ì €ì¥ í›„ ì™„ë£Œ</button>
                    <button class="btn" onclick="showView('start-view')">ì·¨ì†Œ</button>
                </div>
            </div>

            <div id="selection-view" class="view hidden">
                <div style="text-align:center; margin-bottom: 60px;">
                    <h1 id="sentence-display" style="letter-spacing: 10px;"></h1>
                    <p style="color:var(--text-sub)">ì§„í–‰í•  ê·¸ë£¹ì„ ì„ íƒí•´ ì£¼ì„¸ìš”.</p>
                </div>
                <div id="group-buttons-container" style="display:flex; flex-wrap:wrap; justify-content:center; gap:20px;"></div>
            </div>

            <div id="play-view" class="view hidden">
                <div class="timer-progress-wrap"><div id="timer-bar"></div></div>
                <div class="quiz-header">
                    <p style="font-weight:700; color:var(--text-sub)">GROUP: <span id="current-group-name"></span></p>
                    <div style="font-size: 1.5rem; font-weight: 800;">SCORE: <span id="current-score" style="color:var(--primary)">0</span></div>
                </div>
                <div class="word-display" id="word-display">READY</div>
                <div class="quiz-controls">
                    <div class="control-btn btn-correct" onclick="handleAnswer(true)">
                        <span class="symbol">â—‹</span>
                        <span class="label">ì •ë‹µì…ë‹ˆë‹¤</span>
                    </div>
                    <div class="control-btn btn-wrong" onclick="handleAnswer(false)">
                        <span class="symbol">Ã—</span>
                        <span class="label">í‹€ë ¸ìŠµë‹ˆë‹¤</span>
                    </div>
                    <div class="control-btn btn-pass" onclick="handlePass()">
                        <span class="symbol">â–³</span>
                        <span class="label">íŒ¨ìŠ¤!</span>
                    </div>
                </div>
            </div>

            <div id="result-view" class="view hidden">
                <h1 style="text-align:center; margin-bottom: 40px;">í€´ì¦ˆ ê²°ê³¼ ë¦¬í¬íŠ¸</h1>
                <div id="rankings-list" style="max-width: 700px; margin: 0 auto; width: 100%; border-top: 1px solid var(--border);"></div>
                <div style="text-align:center; margin-top: 50px;">
                    <button class="btn btn-filled" onclick="showView('start-view')">ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
                </div>
            </div>
        </main>
    </div>
</div>

<script>
    let quizzes = JSON.parse(localStorage.getItem('quizzes_gemini_v1')) || [];
    let state = { currentQuiz: null, playingIdx: -1, results: [], played: new Set(), timer: null, totalTime: 60, timeLeft: 60, wordIdx: 0, score: 0, words: [] };

    // Theme Toggle
    document.getElementById('theme-toggle').onclick = () => {
        const body = document.body;
        const newTheme = body.getAttribute('data-theme') === 'light' ? 'dark' : 'light';
        body.setAttribute('data-theme', newTheme);
    };

    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.add('hidden'));
        document.getElementById(id).classList.remove('hidden');
        renderSidebar();
    }

    function renderSidebar() {
        const sidebar = document.getElementById('quiz-list-sidebar');
        sidebar.innerHTML = quizzes.map((q, i) => `
            <div onclick="startQuiz(${i})" style="padding:12px; cursor:pointer; border-radius:12px; font-size:0.9rem; font-weight:500;" 
                 onmouseover="this.style.background='var(--primary-light)'" onmouseout="this.style.background='transparent'">
                ${q.title}
            </div>
        `).join('');
    }

    function renderGroupInputs() {
        const c = document.getElementById('groups-container');
        const count = document.getElementById('group-count').value;
        c.innerHTML = '';
        for(let i=0; i<count; i++) {
            c.innerHTML += `
                <div class="group-card">
                    <label style="font-size:0.8rem; font-weight:700; color:var(--text-sub)">GROUP ${i+1}</label>
                    <input type="text" class="g-name input" placeholder="ì´ë¦„ (ì˜ˆ: ì¬)" style="margin:8px 0;">
                    <textarea class="g-words input" placeholder="ë‹¨ì–´ (ì½¤ë§ˆ êµ¬ë¶„)" style="height:80px; resize:none;"></textarea>
                </div>`;
        }
    }

    function openAdmin() {
        showView('admin-view');
        renderGroupInputs();
    }

    function saveQuiz() {
        const title = document.getElementById('quiz-title-input').value;
        const names = document.querySelectorAll('.g-name');
        const words = document.querySelectorAll('.g-words');
        if(!title) return;
        
        let groups = [];
        names.forEach((n, i) => {
            if(n.value) groups.push({ name: n.value, words: words[i].value.split(',').map(s=>s.trim()).filter(s=>s) });
        });
        
        quizzes.push({ title, groups, time: parseInt(document.getElementById('limit-time').value) });
        localStorage.setItem('quizzes_gemini_v1', JSON.stringify(quizzes));
        showView('start-view');
    }

    function startQuiz(idx) {
        state.currentQuiz = quizzes[idx];
        state.results = [];
        state.played.clear();
        showSelection();
    }

    function showSelection() {
        showView('selection-view');
        document.getElementById('sentence-display').innerText = state.currentQuiz.groups.map(g => g.name).join('');
        const container = document.getElementById('group-buttons-container');
        container.innerHTML = state.currentQuiz.groups.map((g, i) => `
            <div class="btn" style="padding:24px; font-size:1.5rem; ${state.played.has(i)?'opacity:0.3; cursor:default;':''}" 
                 onclick="${state.played.has(i)?'':'prepareGame('+i+')'}">${g.name}</div>
        `).join('');
        if(state.played.size === state.currentQuiz.groups.length) showResults();
    }

    function prepareGame(idx) {
        state.playingIdx = idx;
        state.words = [...state.currentQuiz.groups[idx].words].sort(() => Math.random() - 0.5);
        state.wordIdx = 0; state.score = 0; 
        state.totalTime = state.currentQuiz.time;
        state.timeLeft = state.totalTime;
        
        document.getElementById('current-group-name').innerText = state.currentQuiz.groups[idx].name;
        showView('play-view');
        updatePlayUI();
        
        let cnt = 3;
        const disp = document.getElementById('word-display');
        const cd = setInterval(() => {
            disp.innerText = cnt > 0 ? cnt : 'GO';
            if(cnt < 0) { clearInterval(cd); runGame(); }
            cnt--;
        }, 800);
    }

    function runGame() {
        nextWord();
        state.timer = setInterval(() => {
            state.timeLeft -= 0.1;
            updatePlayUI();
            if(state.timeLeft <= 0) endGame();
        }, 100);
    }

    function nextWord() {
        if(state.wordIdx >= state.words.length) return endGame();
        document.getElementById('word-display').innerText = state.words[state.wordIdx];
    }

    function handleAnswer(isO) {
        const main = document.querySelector('main');
        main.classList.remove('animate-success', 'animate-wrong');
        void main.offsetWidth; // Trigger reflow
        main.classList.add(isO ? 'animate-success' : 'animate-wrong');

        if(isO) state.score++;
        state.wordIdx++;
        updatePlayUI();
        nextWord();
    }

    function handlePass() {
        state.wordIdx++;
        updatePlayUI();
        nextWord();
    }

    function updatePlayUI() {
        document.getElementById('current-score').innerText = state.score;
        const bar = document.getElementById('timer-bar');
        const pct = (state.timeLeft / state.totalTime) * 100;
        bar.style.width = pct + '%';
        
        // Color Change
        if(pct > 50) bar.style.backgroundColor = 'var(--primary)';
        else if(pct > 20) bar.style.backgroundColor = 'var(--warning)';
        else bar.style.backgroundColor = 'var(--danger)';
    }

    function endGame() {
        clearInterval(state.timer);
        state.results.push({ name: state.currentQuiz.groups[state.playingIdx].name, score: state.score });
        state.played.add(state.playingIdx);
        showSelection();
    }

    function showResults() {
        showView('result-view');
        const sorted = [...state.results].sort((a,b) => b.score - a.score);
        const container = document.getElementById('rankings-list');
        container.innerHTML = sorted.map((r, i) => `
            <div class="result-item">
                <div class="rank-num">${i+1}</div>
                <div style="flex:1; font-weight:600; font-size:1.1rem;">${r.name} Group</div>
                <div style="font-weight:800; color:var(--primary); font-size:1.4rem;">${r.score} pt</div>
            </div>
        `).join('');
    }

    renderSidebar();
</script>

</body>
</html>
